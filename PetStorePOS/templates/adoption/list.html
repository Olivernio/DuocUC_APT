{% extends 'base.html' %}
{% load static %}

{% block head-tag %}
  <link rel="stylesheet" href="{% static 'css/adoption/adoption.css' %}" />
{% endblock %}

{% block content %}
<div class="container mt-5">
  <div class="text-center mb-5">
    <h1 class="display-4">Adopta un Compañero</h1>
    <p class="lead text-muted">
      Encuentra a tu amigo fiel. Datos proporcionados por <a href="https://huachitos.cl/" target="_blank">Huachitos.cl</a>.
    </p>
  </div>

  <!-- Filtros -->
  <div class="filters-container mb-5">
    <form method="GET" action="{% url 'adoption:list' %}" class="row g-3 justify-content-center align-items-center">
      <div class="col-md-4">
        <label for="tipo" class="form-label visually-hidden">Filtrar por especie:</label>
        <select name="tipo" id="tipo" class="form-select form-select-lg">
          <option value="">Todas las especies</option>
          {% for especie in especies_disponibles %}
            <option value="{{ especie }}" {% if especie == tipo_filtrado %}selected{% endif %}>{{ especie|title }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-2">
        <button type="submit" class="btn btn-primary btn-lg w-100">Filtrar</button>
      </div>
      <div class="col-md-2">
        <a href="{% url 'adoption:list' %}" class="btn btn-outline-secondary btn-lg w-100">Limpiar</a>
      </div>
    </form>
  </div>

  {% if error_message %}
    <div class="alert alert-danger text-center">
        <h2><i class="bi bi-exclamation-triangle-fill"></i> Error de Conexión</h2>
        <p>{{ error_message }}</p>
    </div>
  {% endif %}

  <div class="huachitos-grid">
    {% for mascota in mascotas %}
      <a href="{% url 'adoption:mascota_detail' mascota.id %}" class="huachito-card-link">
        <div class="huachito-card" style="--animation-order: {{ forloop.counter0 }};">
          <div class="card-img-container">
            <img src="{{ mascota.imagen }}" alt="Foto de {{ mascota.nombre }}">
          </div>
          <div class="card-content">
            <div class="card-header">
                <h3 class="card-title">{{ mascota.nombre }}</h3>
                {% with mascota.tipo|lower as tipo %}
                  <span class="card-badge {{ tipo }}">{{ mascota.tipo }}</span>
                {% endwith %}
            </div>
            <div class="card-details">
              <span><i class="bi bi-tag-fill"></i> {{ mascota.edad }}</span>
              <span><i class="bi bi-gender-ambiguous"></i> {{ mascota.genero|title }}</span>
            </div>
            <div class="location">
              <i class="bi bi-geo-alt-fill"></i>
              <span>{{ mascota.comuna }}, {{ mascota.region }}</span>
            </div>
          </div>
          <div class="card-footer-action">
              Ver Detalles
          </div>
        </div>
      </a>
    {% empty %}
      {% if not error_message %}
      <div class="alert alert-info w-100 text-center col-12">
        {% if tipo_filtrado %}
          No se encontraron mascotas del tipo "{{ tipo_filtrado|title }}".
        {% else %}
          No hay mascotas disponibles desde la API en este momento.
        {% endif %}
      </div>
      {% endif %}
    {% endfor %}
  </div>
</div>
{% endblock %}